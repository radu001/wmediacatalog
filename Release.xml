<Project DefaultTargets="BuildRelease"
         xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <Configuration>Release</Configuration>
    <Platform>x86</Platform>
    <OutputPath>$(MSBuildProjectDirectory)\Release</OutputPath>
    <DbToolPath>Utils\DbTool\DbTool\DbTool.csproj</DbToolPath>
    <MainAppPath>MediaCatalog\MediaCatalog.csproj</MainAppPath>
  </PropertyGroup>

  <ItemGroup>
    <LicenseFiles Include="Lib\**\*.license.txt"/>
    <WasteFiles Include="$(OutputPath)\*.pdb"/>
  </ItemGroup>

  <Target Name="BuildRelease" DependsOnTargets="BuildMainApp;BuildDbTool;CopyLicenses;Cleanup"/>

  <Target Name="BuildMainApp">
    <MSBuild Projects="$(MainAppPath)" Properties="Configuration=$(Configuration);Platform=$(Platform);OutputPath=$(OutputPath)"/>
  </Target>
  
  <Target Name="BuildDbTool" AfterTargets="BuildMainApp" >
    <MSBuild Projects="$(DbToolPath)" Properties="Configuration=$(Configuration);Platform=$(Platform);OutputPath=$(OutputPath)"/>
  </Target>

  <Target Name="CopyLicenses" AfterTargets="BuildMainApp;BuildDbTool">
    <Copy SourceFiles="@(LicenseFiles)" DestinationFolder="$(OutputPath)"/>
  </Target>

  <Target Name="Cleanup" AfterTargets="CopyLicenses">
    <Message Text="Perform cleanup" Importance="high"/>
    <Delete Files="@(WasteFiles)"/>
  </Target>
</Project>